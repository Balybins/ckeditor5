/*!
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.adapterCkfinder=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.adapterCkfinder=e())}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=8)}([function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return o}));class n extends Error{constructor(t,e,r){super(`${t}${r?" "+JSON.stringify(r):""}${i(t)}`),this.name="CKEditorError",this.context=e,this.data=r}is(t){return"CKEditorError"===t}static rethrowUnexpectedError(t,e){if(t.is&&t.is("CKEditorError"))throw t;const r=new n(t.message,e);throw r.stack=t.stack,r}}function o(t,e){console.warn(...s(t,e))}function i(t){return"\nRead more: https://ckeditor.com/docs/ckeditor5/latest/framework/guides/support/error-codes.html#error-"+t}function s(t,e){const r=i(t);return e?[t,e,r]:[t,r]}},function(t,e,r){"use strict";var n=r(2),o="object"==typeof self&&self&&self.Object===Object&&self,i=n.a||o||Function("return this")();e.a=i},function(t,e,r){"use strict";(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.a=r}).call(this,r(4))},function(t,e,r){"use strict";(function(t){var n=r(2),o="object"==typeof exports&&exports&&!exports.nodeType&&exports,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,s=i&&i.exports===o&&n.a.process,a=function(){try{var t=i&&i.require&&i.require("util").types;return t||s&&s.binding&&s.binding("util")}catch(t){}}();e.a=a}).call(this,r(5)(t))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,r){"use strict";(function(t){var n=r(1),o=r(7),i="object"==typeof exports&&exports&&!exports.nodeType&&exports,s=i&&"object"==typeof t&&t&&!t.nodeType&&t,a=s&&s.exports===i?n.a.Buffer:void 0,l=(a?a.isBuffer:void 0)||o.a;e.a=l}).call(this,r(5)(t))},function(t,e,r){"use strict";e.a=function(){return!1}},function(t,e,r){t.exports=r(10)},function(t,e,r){"use strict";(function(t){var e=r(0);const n="object"==typeof window?window:t;n.CKEDITOR_VERSION?console.log(new e.a("ckeditor-duplicated-modules",null)):n.CKEDITOR_VERSION="23.1.0"}).call(this,r(4))},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"getCsrfToken",(function(){return re})),r.d(n,"getCookie",(function(){return ne})),r.d(n,"setCookie",(function(){return oe}));var o=function(){return function t(){t.called=!0}};class i{constructor(t,e){this.source=t,this.name=e,this.path=[],this.stop=o(),this.off=o()}}const s=new Array(256).fill().map((t,e)=>("0"+e.toString(16)).slice(-2));function a(){const t=4294967296*Math.random()>>>0,e=4294967296*Math.random()>>>0,r=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return"e"+s[t>>0&255]+s[t>>8&255]+s[t>>16&255]+s[t>>24&255]+s[e>>0&255]+s[e>>8&255]+s[e>>16&255]+s[e>>24&255]+s[r>>0&255]+s[r>>8&255]+s[r>>16&255]+s[r>>24&255]+s[n>>0&255]+s[n>>8&255]+s[n>>16&255]+s[n>>24&255]}var l={get(t){return"number"!=typeof t?this[t]||this.normal:t},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5},c=(r(9),r(0));const d=Symbol("listeningTo"),h=Symbol("emitterId");var u={on(t,e,r={}){this.listenTo(this,t,e,r)},once(t,e,r){let n=!1;this.listenTo(this,t,(function(t,...r){n||(n=!0,t.off(),e.call(this,t,...r))}),r)},off(t,e){this.stopListening(this,t,e)},listenTo(t,e,r,n={}){let o,i;this[d]||(this[d]={});const s=this[d];p(t)||function(t,e){t[h]||(t[h]=e||a())}(t);const c=p(t);(o=s[c])||(o=s[c]={emitter:t,callbacks:{}}),(i=o.callbacks[e])||(i=o.callbacks[e]=[]),i.push(r),function(t,e){const r=f(t);if(r[e])return;let n=e,o=null;const i=[];for(;""!==n&&!r[n];)r[n]={callbacks:[],childEvents:[]},i.push(r[n]),o&&r[n].childEvents.push(o),o=n,n=n.substr(0,n.lastIndexOf(":"));if(""!==n){for(const t of i)t.callbacks=r[n].callbacks.slice();r[n].childEvents.push(o)}}(t,e);const u=b(t,e),g=l.get(n.priority),_={callback:r,priority:g};for(const t of u){let e=!1;for(let r=0;r<t.length;r++)if(t[r].priority<g){t.splice(r,0,_),e=!0;break}e||t.push(_)}},stopListening(t,e,r){const n=this[d];let o=t&&p(t);const i=n&&o&&n[o],s=i&&e&&i.callbacks[e];if(!(!n||t&&!i||e&&!s))if(r){_(t,e,r);-1!==s.indexOf(r)&&(1===s.length?delete i.callbacks[e]:_(t,e,r))}else if(s){for(;r=s.pop();)_(t,e,r);delete i.callbacks[e]}else if(i){for(e in i.callbacks)this.stopListening(t,e);delete n[o]}else{for(o in n)this.stopListening(n[o].emitter);delete this[d]}},fire(t,...e){try{const r=t instanceof i?t:new i(this,t),n=r.name;let o=function t(e,r){let n;if(!e._events||!(n=e._events[r])||!n.callbacks.length)return r.indexOf(":")>-1?t(e,r.substr(0,r.lastIndexOf(":"))):null;return n.callbacks}(this,n);if(r.path.push(this),o){const t=[r,...e];o=Array.from(o);for(let e=0;e<o.length&&(o[e].callback.apply(this,t),r.off.called&&(delete r.off.called,_(this,n,o[e].callback)),!r.stop.called);e++);}if(this._delegations){const t=this._delegations.get(n),o=this._delegations.get("*");t&&g(t,r,e),o&&g(o,r,e)}return r.return}catch(t){c.a.rethrowUnexpectedError(t,this)}},delegate(...t){return{to:(e,r)=>{this._delegations||(this._delegations=new Map),t.forEach(t=>{const n=this._delegations.get(t);n?n.set(e,r):this._delegations.set(t,new Map([[e,r]]))})}}},stopDelegating(t,e){if(this._delegations)if(t)if(e){const r=this._delegations.get(t);r&&r.delete(e)}else this._delegations.delete(t);else this._delegations.clear()}};function p(t){return t[h]}function f(t){return t._events||Object.defineProperty(t,"_events",{value:{}}),t._events}function b(t,e){const r=f(t)[e];if(!r)return[];let n=[r.callbacks];for(let e=0;e<r.childEvents.length;e++){const o=b(t,r.childEvents[e]);n=n.concat(o)}return n}function g(t,e,r){for(let[n,o]of t){o?"function"==typeof o&&(o=o(e.name)):o=e.name;const t=new i(e.source,o);t.path=[...e.path],n.fire(t,...r)}}function _(t,e,r){const n=b(t,e);for(const t of n)for(let e=0;e<t.length;e++)t[e].callback==r&&(t.splice(e,1),e--)}var y=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},v=r(1),m=v.a.Symbol,w=Object.prototype,j=w.hasOwnProperty,x=w.toString,k=m?m.toStringTag:void 0;var E=function(t){var e=j.call(t,k),r=t[k];try{t[k]=void 0;var n=!0}catch(t){}var o=x.call(t);return n&&(e?t[k]=r:delete t[k]),o},O=Object.prototype.toString;var P=function(t){return O.call(t)},T=m?m.toStringTag:void 0;var M=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":T&&T in Object(t)?E(t):P(t)};var A,I=function(t){if(!y(t))return!1;var e=M(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},S=v.a["__core-js_shared__"],C=(A=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"";var F=function(t){return!!C&&C in t},U=Function.prototype.toString;var L=function(t){if(null!=t){try{return U.call(t)}catch(t){}try{return t+""}catch(t){}}return""},R=/^\[object .+?Constructor\]$/,B=Function.prototype,W=Object.prototype,$=B.toString,q=W.hasOwnProperty,D=RegExp("^"+$.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var K=function(t){return!(!y(t)||F(t))&&(I(t)?D:R).test(L(t))};var N=function(t,e){return null==t?void 0:t[e]};var z=function(t,e){var r=N(t,e);return K(r)?r:void 0},V=function(){try{var t=z(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var G=function(t,e,r){"__proto__"==e&&V?V(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r};var H=function(t,e){return t===e||t!=t&&e!=e},J=Object.prototype.hasOwnProperty;var X=function(t,e,r){var n=t[e];J.call(t,e)&&H(n,r)&&(void 0!==r||e in t)||G(t,e,r)};var Q=function(t,e,r,n){var o=!r;r||(r={});for(var i=-1,s=e.length;++i<s;){var a=e[i],l=n?n(r[a],t[a],a,r,t):void 0;void 0===l&&(l=t[a]),o?G(r,a,l):X(r,a,l)}return r};var Y=function(t){return t};var Z=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},tt=Math.max;var et=function(t,e,r){return e=tt(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=tt(n.length-e,0),s=Array(i);++o<i;)s[o]=n[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=n[o];return a[e]=r(s),Z(t,this,a)}};var rt=function(t){return function(){return t}},nt=V?function(t,e){return V(t,"toString",{configurable:!0,enumerable:!1,value:rt(e),writable:!0})}:Y,ot=Date.now;var it=function(t){var e=0,r=0;return function(){var n=ot(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(nt);var st=function(t,e){return it(et(t,e,Y),t+"")};var at=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var lt=function(t){return null!=t&&at(t.length)&&!I(t)},ct=/^(?:0|[1-9]\d*)$/;var dt=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&ct.test(t))&&t>-1&&t%1==0&&t<e};var ht=function(t,e,r){if(!y(r))return!1;var n=typeof e;return!!("number"==n?lt(r)&&dt(e,r.length):"string"==n&&e in r)&&H(r[e],t)};var ut=function(t){return st((function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,s=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,s&&ht(r[0],r[1],s)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var a=r[n];a&&t(e,a,n,i)}return e}))};var pt=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var ft=function(t){return null!=t&&"object"==typeof t};var bt=function(t){return ft(t)&&"[object Arguments]"==M(t)},gt=Object.prototype,_t=gt.hasOwnProperty,yt=gt.propertyIsEnumerable,vt=bt(function(){return arguments}())?bt:function(t){return ft(t)&&_t.call(t,"callee")&&!yt.call(t,"callee")},mt=Array.isArray,wt=r(6),jt={};jt["[object Float32Array]"]=jt["[object Float64Array]"]=jt["[object Int8Array]"]=jt["[object Int16Array]"]=jt["[object Int32Array]"]=jt["[object Uint8Array]"]=jt["[object Uint8ClampedArray]"]=jt["[object Uint16Array]"]=jt["[object Uint32Array]"]=!0,jt["[object Arguments]"]=jt["[object Array]"]=jt["[object ArrayBuffer]"]=jt["[object Boolean]"]=jt["[object DataView]"]=jt["[object Date]"]=jt["[object Error]"]=jt["[object Function]"]=jt["[object Map]"]=jt["[object Number]"]=jt["[object Object]"]=jt["[object RegExp]"]=jt["[object Set]"]=jt["[object String]"]=jt["[object WeakMap]"]=!1;var xt=function(t){return ft(t)&&at(t.length)&&!!jt[M(t)]};var kt=function(t){return function(e){return t(e)}},Et=r(3),Ot=Et.a&&Et.a.isTypedArray,Pt=Ot?kt(Ot):xt,Tt=Object.prototype.hasOwnProperty;var Mt=function(t,e){var r=mt(t),n=!r&&vt(t),o=!r&&!n&&Object(wt.a)(t),i=!r&&!n&&!o&&Pt(t),s=r||n||o||i,a=s?pt(t.length,String):[],l=a.length;for(var c in t)!e&&!Tt.call(t,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||dt(c,l))||a.push(c);return a},At=Object.prototype;var It=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||At)};var St=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},Ct=Object.prototype.hasOwnProperty;var Ft=function(t){if(!y(t))return St(t);var e=It(t),r=[];for(var n in t)("constructor"!=n||!e&&Ct.call(t,n))&&r.push(n);return r};var Ut=function(t){return lt(t)?Mt(t,!0):Ft(t)},Lt=ut((function(t,e){Q(e,Ut(e),t)}));const Rt=Symbol("observableProperties"),Bt=Symbol("boundObservables"),Wt=Symbol("boundProperties"),$t={set(t,e){if(y(t))return void Object.keys(t).forEach(e=>{this.set(e,t[e])},this);Dt(this);const r=this[Rt];if(t in this&&!r.has(t))throw new c.a("observable-set-cannot-override",this);Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:()=>r.get(t),set(e){const n=r.get(t);let o=this.fire("set:"+t,t,e,n);void 0===o&&(o=e),n===o&&r.has(t)||(r.set(t,o),this.fire("change:"+t,t,o,n))}}),this[t]=e},bind(...t){if(!t.length||!zt(t))throw new c.a("observable-bind-wrong-properties",this);if(new Set(t).size!==t.length)throw new c.a("observable-bind-duplicate-properties",this);Dt(this);const e=this[Wt];t.forEach(t=>{if(e.has(t))throw new c.a("observable-bind-rebind",this)});const r=new Map;return t.forEach(t=>{const n={property:t,to:[]};e.set(t,n),r.set(t,n)}),{to:Kt,toMany:Nt,_observable:this,_bindProperties:t,_to:[],_bindings:r}},unbind(...t){if(!this[Rt])return;const e=this[Wt],r=this[Bt];if(t.length){if(!zt(t))throw new c.a("observable-unbind-wrong-properties",this);t.forEach(t=>{const n=e.get(t);if(!n)return;let o,i,s,a;n.to.forEach(t=>{o=t[0],i=t[1],s=r.get(o),a=s[i],a.delete(n),a.size||delete s[i],Object.keys(s).length||(r.delete(o),this.stopListening(o,"change"))}),e.delete(t)})}else r.forEach((t,e)=>{this.stopListening(e,"change")}),r.clear(),e.clear()},decorate(t){const e=this[t];if(!e)throw new c.a("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:t});this.on(t,(t,r)=>{t.return=e.apply(this,r)}),this[t]=function(...e){return this.fire(t,e)}}};Lt($t,u);var qt=$t;function Dt(t){t[Rt]||(Object.defineProperty(t,Rt,{value:new Map}),Object.defineProperty(t,Bt,{value:new Map}),Object.defineProperty(t,Wt,{value:new Map}))}function Kt(...t){const e=function(...t){if(!t.length)throw new c.a("observable-bind-to-parse-error",null);const e={to:[]};let r;"function"==typeof t[t.length-1]&&(e.callback=t.pop());return t.forEach(t=>{if("string"==typeof t)r.properties.push(t);else{if("object"!=typeof t)throw new c.a("observable-bind-to-parse-error",null);r={observable:t,properties:[]},e.to.push(r)}}),e}(...t),r=Array.from(this._bindings.keys()),n=r.length;if(!e.callback&&e.to.length>1)throw new c.a("observable-bind-to-no-callback",this);if(n>1&&e.callback)throw new c.a("observable-bind-to-extra-callback",this);var o;e.to.forEach(t=>{if(t.properties.length&&t.properties.length!==n)throw new c.a("observable-bind-to-properties-length",this);t.properties.length||(t.properties=this._bindProperties)}),this._to=e.to,e.callback&&(this._bindings.get(r[0]).callback=e.callback),o=this._observable,this._to.forEach(t=>{const e=o[Bt];let r;e.get(t.observable)||o.listenTo(t.observable,"change",(n,i)=>{r=e.get(t.observable)[i],r&&r.forEach(t=>{Vt(o,t.property)})})}),function(t){let e;t._bindings.forEach((r,n)=>{t._to.forEach(o=>{e=o.properties[r.callback?0:t._bindProperties.indexOf(n)],r.to.push([o.observable,e]),function(t,e,r,n){const o=t[Bt],i=o.get(r),s=i||{};s[n]||(s[n]=new Set);s[n].add(e),i||o.set(r,s)}(t._observable,r,o.observable,e)})})}(this),this._bindProperties.forEach(t=>{Vt(this._observable,t)})}function Nt(t,e,r){if(this._bindings.size>1)throw new c.a("observable-bind-to-many-not-one-binding",this);this.to(...function(t,e){const r=t.map(t=>[t,e]);return Array.prototype.concat.apply([],r)}(t,e),r)}function zt(t){return t.every(t=>"string"==typeof t)}function Vt(t,e){const r=t[Wt].get(e);let n;r.callback?n=r.callback.apply(t,r.to.map(t=>t[0][t[1]])):(n=r.to[0],n=n[0][n[1]]),Object.prototype.hasOwnProperty.call(t,e)?t[e]=n:t.set(e,n)}function Gt(t,...e){e.forEach(e=>{Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)).forEach(r=>{if(r in t.prototype)return;const n=Object.getOwnPropertyDescriptor(e,r);n.enumerable=!1,Object.defineProperty(t.prototype,r,n)})})}class Ht{constructor(t){this.editor=t,this.set("isEnabled",!0),this._disableStack=new Set}forceDisabled(t){this._disableStack.add(t),1==this._disableStack.size&&(this.on("set:isEnabled",Jt,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(t){this._disableStack.delete(t),0==this._disableStack.size&&(this.off("set:isEnabled",Jt),this.isEnabled=!0)}destroy(){this.stopListening()}static get isContextPlugin(){return!1}}function Jt(t){t.return=!1,t.stop()}Gt(Ht,qt);class Xt{constructor(t){this.context=t}destroy(){this.stopListening()}static get isContextPlugin(){return!0}}Gt(Xt,qt);class Qt{constructor(t={},e={}){const r=!(!(n=t)||!n[Symbol.iterator]);var n;if(r||(e=t),this._items=[],this._itemMap=new Map,this._idProperty=e.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],r)for(const e of t)this._items.push(e),this._itemMap.set(this._getItemIdBeforeAdding(e),e)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(t,e){return this.addMany([t],e)}addMany(t,e){if(void 0===e)e=this._items.length;else if(e>this._items.length||e<0)throw new c.a("collection-add-item-invalid-index",this);for(let r=0;r<t.length;r++){const n=t[r],o=this._getItemIdBeforeAdding(n),i=e+r;this._items.splice(i,0,n),this._itemMap.set(o,n),this.fire("add",n,i)}return this.fire("change",{added:t,removed:[],index:e}),this}get(t){let e;if("string"==typeof t)e=this._itemMap.get(t);else{if("number"!=typeof t)throw new c.a("collection-get-invalid-arg",this);e=this._items[t]}return e||null}has(t){if("string"==typeof t)return this._itemMap.has(t);{const e=t[this._idProperty];return this._itemMap.has(e)}}getIndex(t){let e;return e="string"==typeof t?this._itemMap.get(t):t,this._items.indexOf(e)}remove(t){const[e,r]=this._remove(t);return this.fire("change",{added:[],removed:[e],index:r}),e}map(t,e){return this._items.map(t,e)}find(t,e){return this._items.find(t,e)}filter(t,e){return this._items.filter(t,e)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const t=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:t,index:0})}bindTo(t){if(this._bindToCollection)throw new c.a("collection-bind-to-rebind",this);return this._bindToCollection=t,{as:t=>{this._setUpBindToBinding(e=>new t(e))},using:t=>{"function"==typeof t?this._setUpBindToBinding(e=>t(e)):this._setUpBindToBinding(e=>e[t])}}}_setUpBindToBinding(t){const e=this._bindToCollection,r=(r,n,o)=>{const i=e._bindToCollection==this,s=e._bindToInternalToExternalMap.get(n);if(i&&s)this._bindToExternalToInternalMap.set(n,s),this._bindToInternalToExternalMap.set(s,n);else{const r=t(n);if(!r)return void this._skippedIndexesFromExternal.push(o);let i=o;for(const t of this._skippedIndexesFromExternal)o>t&&i--;for(const t of e._skippedIndexesFromExternal)i>=t&&i++;this._bindToExternalToInternalMap.set(n,r),this._bindToInternalToExternalMap.set(r,n),this.add(r,i);for(let t=0;t<e._skippedIndexesFromExternal.length;t++)i<=e._skippedIndexesFromExternal[t]&&e._skippedIndexesFromExternal[t]++}};for(const t of e)r(0,t,e.getIndex(t));this.listenTo(e,"add",r),this.listenTo(e,"remove",(t,e,r)=>{const n=this._bindToExternalToInternalMap.get(e);n&&this.remove(n),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((t,e)=>(r<e&&t.push(e-1),r>e&&t.push(e),t),[])})}_getItemIdBeforeAdding(t){const e=this._idProperty;let r;if(e in t){if(r=t[e],"string"!=typeof r)throw new c.a("collection-add-invalid-id",this);if(this.get(r))throw new c.a("collection-add-item-already-exists",this)}else t[e]=r=a();return r}_remove(t){let e,r,n,o=!1;const i=this._idProperty;if("string"==typeof t?(r=t,n=this._itemMap.get(r),o=!n,n&&(e=this._items.indexOf(n))):"number"==typeof t?(e=t,n=this._items[e],o=!n,n&&(r=n[i])):(n=t,r=n[i],e=this._items.indexOf(n),o=-1==e||!this._itemMap.get(r)),o)throw new c.a("collection-remove-404",this);this._items.splice(e,1),this._itemMap.delete(r);const s=this._bindToInternalToExternalMap.get(n);return this._bindToInternalToExternalMap.delete(n),this._bindToExternalToInternalMap.delete(s),this.fire("remove",n,e),[n,e]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}Gt(Qt,u);class Yt extends Xt{static get pluginName(){return"PendingActions"}init(){this.set("hasAny",!1),this._actions=new Qt({idProperty:"_id"}),this._actions.delegate("add","remove").to(this)}add(t){if("string"!=typeof t)throw new c.a("pendingactions-add-invalid-message",this);const e=Object.create(qt);return e.set("message",t),this._actions.add(e),this.hasAny=!0,e}remove(t){this._actions.remove(t),this.hasAny=!!this._actions.length}get first(){return this._actions.get(0)}[Symbol.iterator](){return this._actions[Symbol.iterator]()}}class Zt{constructor(){const t=new window.FileReader;this._reader=t,this._data=void 0,this.set("loaded",0),t.onprogress=t=>{this.loaded=t.loaded}}get error(){return this._reader.error}get data(){return this._data}read(t){const e=this._reader;return this.total=t.size,new Promise((r,n)=>{e.onload=()=>{const t=e.result;this._data=t,r(t)},e.onerror=()=>{n("error")},e.onabort=()=>{n("aborted")},this._reader.readAsDataURL(t)})}abort(){this._reader.abort()}}Gt(Zt,qt);class te extends Ht{static get pluginName(){return"FileRepository"}static get requires(){return[Yt]}init(){this.loaders=new Qt,this.loaders.on("add",()=>this._updatePendingAction()),this.loaders.on("remove",()=>this._updatePendingAction()),this._loadersMap=new Map,this._pendingAction=null,this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(t,e)=>e?t/e*100:0)}getLoader(t){return this._loadersMap.get(t)||null}createLoader(t){if(!this.createUploadAdapter)return Object(c.b)("filerepository-no-upload-adapter"),null;const e=new ee(Promise.resolve(t),this.createUploadAdapter);return this.loaders.add(e),this._loadersMap.set(t,e),t instanceof Promise&&e.file.then(t=>{this._loadersMap.set(t,e)}).catch(()=>{}),e.on("change:uploaded",()=>{let t=0;for(const e of this.loaders)t+=e.uploaded;this.uploaded=t}),e.on("change:uploadTotal",()=>{let t=0;for(const e of this.loaders)e.uploadTotal&&(t+=e.uploadTotal);this.uploadTotal=t}),e}destroyLoader(t){const e=t instanceof ee?t:this.getLoader(t);e._destroy(),this.loaders.remove(e),this._loadersMap.forEach((t,r)=>{t===e&&this._loadersMap.delete(r)})}_updatePendingAction(){const t=this.editor.plugins.get(Yt);if(this.loaders.length){if(!this._pendingAction){const e=this.editor.t,r=t=>`${e("Upload in progress")} ${parseInt(t)}%.`;this._pendingAction=t.add(r(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",r)}}else t.remove(this._pendingAction),this._pendingAction=null}}Gt(te,qt);class ee{constructor(t,e){this.id=a(),this._filePromiseWrapper=this._createFilePromiseWrapper(t),this._adapter=e(this),this._reader=new Zt,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(t,e)=>e?t/e*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(t=>this._filePromiseWrapper?t:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if("idle"!=this.status)throw new c.a("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(t=>this._reader.read(t)).then(t=>{if("reading"!==this.status)throw this.status;return this.status="idle",t}).catch(t=>{if("aborted"===t)throw this.status="aborted","aborted";throw this.status="error",this._reader.error?this._reader.error:t})}upload(){if("idle"!=this.status)throw new c.a("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(t=>(this.uploadResponse=t,this.status="idle",t)).catch(t=>{if("aborted"===this.status)throw"aborted";throw this.status="error",t})}abort(){const t=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?"reading"==t?this._reader.abort():"uploading"==t&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(t){const e={};return e.promise=new Promise((r,n)=>{e.rejecter=n,e.isFulfilled=!1,t.then(t=>{e.isFulfilled=!0,r(t)}).catch(t=>{e.isFulfilled=!0,n(t)})}),e}}Gt(ee,qt);function re(){let t=ne("ckCsrfToken");return t&&40==t.length||(t=function(t){let e="";const r=new Uint8Array(t);window.crypto.getRandomValues(r);for(let t=0;t<r.length;t++){const n="abcdefghijklmnopqrstuvwxyz0123456789".charAt(r[t]%"abcdefghijklmnopqrstuvwxyz0123456789".length);e+=Math.random()>.5?n.toUpperCase():n}return e}(40),oe("ckCsrfToken",t)),t}function ne(t){t=t.toLowerCase();const e=document.cookie.split(";");for(const r of e){const e=r.split("=");if(decodeURIComponent(e[0].trim().toLowerCase())===t)return decodeURIComponent(e[1])}return null}function oe(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+";path=/"}class ie{constructor(t,e,r){this.loader=t,this.url=e,this.t=r}upload(){return this.loader.file.then(t=>new Promise((e,r)=>{this._initRequest(),this._initListeners(e,r,t),this._sendRequest(t)}))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const t=this.xhr=new XMLHttpRequest;t.open("POST",this.url,!0),t.responseType="json"}_initListeners(t,e,r){const n=this.xhr,o=this.loader,i=(0,this.t)("Cannot upload file:")+` ${r.name}.`;n.addEventListener("error",()=>e(i)),n.addEventListener("abort",()=>e()),n.addEventListener("load",()=>{const r=n.response;if(!r||!r.uploaded)return e(r&&r.error&&r.error.message?r.error.message:i);t({default:r.url})}),n.upload&&n.upload.addEventListener("progress",t=>{t.lengthComputable&&(o.uploadTotal=t.total,o.uploaded=t.loaded)})}_sendRequest(t){const e=new FormData;e.append("upload",t),e.append("ckCsrfToken",re()),this.xhr.send(e)}}e.default={CKFinderUploadAdapter:class extends Ht{static get requires(){return[te]}static get pluginName(){return"CKFinderUploadAdapter"}init(){const t=this.editor.config.get("ckfinder.uploadUrl");t&&(this.editor.plugins.get(te).createUploadAdapter=e=>new ie(e,t,this.editor.t))}},utils:n}}]).default}));
//# sourceMappingURL=ckeditor.js.map